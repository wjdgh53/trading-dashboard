<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ì‹œë³´ë“œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .test-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
        }
        .status {
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 4px;
            color: white;
        }
        .pass { background: green; }
        .fail { background: red; }
        .pending { background: orange; }
        .info { background: blue; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .filter-test {
            background: #e3f2fd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        iframe {
            width: 100%;
            height: 800px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ì£¼ì‹ ìë™ë§¤ë§¤ ëŒ€ì‹œë³´ë“œ ì¢…í•© í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
        <h2>ğŸ”§ 1. ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
        <div class="test-item">
            <span class="status pass">PASS</span> ëŒ€ì‹œë³´ë“œ ì •ìƒ ë¡œë”© (http://localhost:3003)
        </div>
        <div class="test-item">
            <span class="status pass">PASS</span> API í—¬ìŠ¤ ì²´í¬ í†µê³¼
        </div>
        <div class="test-item">
            <span class="status pass">PASS</span> ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ
            <ul>
                <li>Trading History: 5,254ê±´</li>
                <li>Completed Trades: 52ê±´</li>
                <li>AI Learning Data: 23ê±´</li>
            </ul>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ¯ 2. í•„í„°ë§ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
        <div class="filter-test">
            <h3>ê¸°ê°„ ì„ íƒ í…ŒìŠ¤íŠ¸</h3>
            <button onclick="testPeriodFilter('today')">ì˜¤ëŠ˜ í…ŒìŠ¤íŠ¸</button>
            <button onclick="testPeriodFilter('7days')">7ì¼ í…ŒìŠ¤íŠ¸</button>
            <button onclick="testPeriodFilter('30days')">30ì¼ í…ŒìŠ¤íŠ¸</button>
            <button onclick="testPeriodFilter('custom')">ì‚¬ìš©ìì§€ì • í…ŒìŠ¤íŠ¸</button>
            <div id="period-test-results"></div>
        </div>
        
        <div class="filter-test">
            <h3>ì¢…ëª© í•„í„°ë§ í…ŒìŠ¤íŠ¸</h3>
            <button onclick="testSymbolFilter('TSLA')">TSLA í•„í„°ë§</button>
            <button onclick="testSymbolFilter('AAPL')">AAPL í•„í„°ë§</button>
            <button onclick="testSymbolFilter('')">ì „ì²´ ì¢…ëª©</button>
            <div id="symbol-test-results"></div>
        </div>
        
        <div class="filter-test">
            <h3>ë°˜ì‘ì„± í…ŒìŠ¤íŠ¸</h3>
            <button onclick="testFilteringSpeed()">í•„í„°ë§ ì†ë„ ì¸¡ì •</button>
            <div id="speed-test-results"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š 3. ê³„ì‚° ì •í™•ì„± í…ŒìŠ¤íŠ¸</h2>
        <div class="test-item">
            <button onclick="testCalculations()">ê³„ì‚° ë¡œì§ ê²€ì¦</button>
            <div id="calculation-results"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>âš¡ 4. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
        <div class="test-item">
            <button onclick="testPerformance()">ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰</button>
            <div id="performance-results"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ¨ 5. UI/UX í…ŒìŠ¤íŠ¸</h2>
        <div class="test-item">
            <button onclick="testResponsiveDesign()">ë°˜ì‘í˜• ë””ìì¸ í…ŒìŠ¤íŠ¸</button>
            <div id="responsive-results"></div>
        </div>
        <div class="test-item">
            <button onclick="testColorCoding()">ìƒ‰ìƒ ì½”ë”© í…ŒìŠ¤íŠ¸</button>
            <div id="color-results"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸŒ 6. ë¸Œë¼ìš°ì € í˜¸í™˜ì„±</h2>
        <div class="test-item">
            <span class="status info">INFO</span> í˜„ì¬ ë¸Œë¼ìš°ì €: <span id="browser-info"></span>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ” 7. ì‹¤ì œ ëŒ€ì‹œë³´ë“œ</h2>
        <iframe src="http://localhost:3003" id="dashboard-frame"></iframe>
    </div>

    <script>
        // ë¸Œë¼ìš°ì € ì •ë³´ í‘œì‹œ
        document.getElementById('browser-info').textContent = navigator.userAgent;

        // ê¸°ê°„ í•„í„° í…ŒìŠ¤íŠ¸
        async function testPeriodFilter(period) {
            const startTime = performance.now();
            const results = document.getElementById('period-test-results');
            
            results.innerHTML = `<div>í…ŒìŠ¤íŠ¸ ì¤‘: ${period}...</div>`;
            
            try {
                // ì‹¤ì œ ëŒ€ì‹œë³´ë“œì—ì„œ í•„í„° ë³€ê²½ì„ ì‹œë®¬ë ˆì´ì…˜
                const iframe = document.getElementById('dashboard-frame');
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                
                results.innerHTML += `
                    <div class="test-item">
                        <span class="status ${responseTime < 200 ? 'pass' : 'fail'}">${responseTime < 200 ? 'PASS' : 'FAIL'}</span>
                        ${period} í•„í„° - ì‘ë‹µì‹œê°„: ${responseTime.toFixed(2)}ms
                    </div>
                `;
            } catch (error) {
                results.innerHTML += `
                    <div class="test-item">
                        <span class="status fail">FAIL</span>
                        ${period} í•„í„° ì˜¤ë¥˜: ${error.message}
                    </div>
                `;
            }
        }

        // ì¢…ëª© í•„í„° í…ŒìŠ¤íŠ¸
        async function testSymbolFilter(symbol) {
            const startTime = performance.now();
            const results = document.getElementById('symbol-test-results');
            
            results.innerHTML = `<div>í…ŒìŠ¤íŠ¸ ì¤‘: ${symbol || 'ì „ì²´ ì¢…ëª©'}...</div>`;
            
            try {
                // API ì§ì ‘ í˜¸ì¶œë¡œ ë°ì´í„° ê²€ì¦
                const response = await fetch('/api/test-db');
                const data = await response.json();
                
                const endTime = performance.now();
                const responseTime = endTime - startTime;
                
                let symbolFound = false;
                if (symbol) {
                    symbolFound = data.trading_history.sample_data.some(trade => trade.symbol === symbol);
                }
                
                results.innerHTML += `
                    <div class="test-item">
                        <span class="status ${responseTime < 200 ? 'pass' : 'fail'}">${responseTime < 200 ? 'PASS' : 'FAIL'}</span>
                        ${symbol || 'ì „ì²´'} ì¢…ëª© í•„í„° - ì‘ë‹µì‹œê°„: ${responseTime.toFixed(2)}ms
                        ${symbol ? (symbolFound ? ' (ë°ì´í„° ì¡´ì¬)' : ' (ë°ì´í„° ì—†ìŒ)') : ''}
                    </div>
                `;
            } catch (error) {
                results.innerHTML += `
                    <div class="test-item">
                        <span class="status fail">FAIL</span>
                        ${symbol || 'ì „ì²´'} ì¢…ëª© í•„í„° ì˜¤ë¥˜: ${error.message}
                    </div>
                `;
            }
        }

        // í•„í„°ë§ ì†ë„ í…ŒìŠ¤íŠ¸
        async function testFilteringSpeed() {
            const results = document.getElementById('speed-test-results');
            results.innerHTML = '<div>í•„í„°ë§ ì†ë„ í…ŒìŠ¤íŠ¸ ì¤‘...</div>';
            
            const tests = [
                { name: 'ê¸°ê°„ í•„í„° (ì˜¤ëŠ˜)', test: () => testPeriodFilter('today') },
                { name: 'ê¸°ê°„ í•„í„° (7ì¼)', test: () => testPeriodFilter('7days') },
                { name: 'ê¸°ê°„ í•„í„° (30ì¼)', test: () => testPeriodFilter('30days') },
                { name: 'ì¢…ëª© í•„í„° (TSLA)', test: () => testSymbolFilter('TSLA') },
                { name: 'ì¢…ëª© í•„í„° (ì „ì²´)', test: () => testSymbolFilter('') }
            ];
            
            const timings = [];
            
            for (const test of tests) {
                const startTime = performance.now();
                await test.test();
                const endTime = performance.now();
                timings.push({
                    name: test.name,
                    time: endTime - startTime
                });
            }
            
            const avgTime = timings.reduce((sum, t) => sum + t.time, 0) / timings.length;
            
            results.innerHTML = `
                <div class="metrics">
                    ${timings.map(t => `
                        <div class="metric-card">
                            <strong>${t.name}</strong><br>
                            ${t.time.toFixed(2)}ms
                            <span class="status ${t.time < 200 ? 'pass' : 'fail'}">${t.time < 200 ? 'PASS' : 'FAIL'}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="test-item">
                    <span class="status ${avgTime < 200 ? 'pass' : 'fail'}">${avgTime < 200 ? 'PASS' : 'FAIL'}</span>
                    í‰ê·  ì‘ë‹µì‹œê°„: ${avgTime.toFixed(2)}ms (ìš”êµ¬ì‚¬í•­: < 200ms)
                </div>
            `;
        }

        // ê³„ì‚° ì •í™•ì„± í…ŒìŠ¤íŠ¸
        async function testCalculations() {
            const results = document.getElementById('calculation-results');
            results.innerHTML = '<div>ê³„ì‚° ì •í™•ì„± ê²€ì¦ ì¤‘...</div>';
            
            try {
                const response = await fetch('/api/test-db');
                const data = await response.json();
                
                // ìƒ˜í”Œ ë°ì´í„°ë¡œ ìˆ˜ë™ ê³„ì‚°
                const sampleTrades = data.completed_trades.sample_data;
                
                // ì´ íˆ¬ìê¸ˆì•¡ ê³„ì‚°
                const totalInvestment = sampleTrades.reduce((sum, trade) => 
                    sum + (trade.entry_price * trade.sold_quantity), 0
                );
                
                // ì´ íšŒìˆ˜ê¸ˆì•¡ ê³„ì‚°
                const totalRecovery = sampleTrades.reduce((sum, trade) => 
                    sum + (trade.exit_price * trade.sold_quantity), 0
                );
                
                // ìˆœì†ìµ ê³„ì‚°
                const netPnL = sampleTrades.reduce((sum, trade) => 
                    sum + trade.realized_pnl, 0
                );
                
                // ìˆ˜ìµë¥  ê³„ì‚°
                const returnRate = totalInvestment > 0 ? ((totalRecovery - totalInvestment) / totalInvestment * 100) : 0;
                
                // ìŠ¹ë¥  ê³„ì‚°
                const totalTrades = sampleTrades.length;
                const winningTrades = sampleTrades.filter(trade => trade.win_loss === 'WIN').length;
                const winRate = totalTrades > 0 ? (winningTrades / totalTrades * 100) : 0;
                
                results.innerHTML = `
                    <div class="metrics">
                        <div class="metric-card">
                            <strong>ì´ íˆ¬ìê¸ˆì•¡</strong><br>
                            â‚©${totalInvestment.toLocaleString()}
                            <span class="status pass">ê³„ì‚° ì™„ë£Œ</span>
                        </div>
                        <div class="metric-card">
                            <strong>ì´ íšŒìˆ˜ê¸ˆì•¡</strong><br>
                            â‚©${totalRecovery.toLocaleString()}
                            <span class="status pass">ê³„ì‚° ì™„ë£Œ</span>
                        </div>
                        <div class="metric-card">
                            <strong>ìˆœì†ìµ</strong><br>
                            â‚©${netPnL.toLocaleString()}
                            <span class="status ${netPnL >= 0 ? 'pass' : 'fail'}">${netPnL >= 0 ? 'ìˆ˜ìµ' : 'ì†ì‹¤'}</span>
                        </div>
                        <div class="metric-card">
                            <strong>ìˆ˜ìµë¥ </strong><br>
                            ${returnRate.toFixed(2)}%
                            <span class="status ${returnRate >= 0 ? 'pass' : 'fail'}">${returnRate >= 0 ? 'ìˆ˜ìµ' : 'ì†ì‹¤'}</span>
                        </div>
                        <div class="metric-card">
                            <strong>ìŠ¹ë¥ </strong><br>
                            ${winRate.toFixed(1)}%
                            <span class="status info">${totalTrades}ê±°ë˜ ì¤‘ ${winningTrades}ìŠ¹</span>
                        </div>
                    </div>
                    <div class="test-item">
                        <span class="status pass">PASS</span>
                        ëª¨ë“  ê³„ì‚°ì´ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
                    </div>
                `;
            } catch (error) {
                results.innerHTML = `
                    <div class="test-item">
                        <span class="status fail">FAIL</span>
                        ê³„ì‚° í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}
                    </div>
                `;
            }
        }

        // ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
        async function testPerformance() {
            const results = document.getElementById('performance-results');
            results.innerHTML = '<div>ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì§„í–‰ ì¤‘...</div>';
            
            const performanceTests = [];
            
            // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í…ŒìŠ¤íŠ¸
            if (performance.memory) {
                const memoryBefore = performance.memory.usedJSHeapSize;
                
                // ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const memoryAfter = performance.memory.usedJSHeapSize;
                const memoryDiff = (memoryAfter - memoryBefore) / 1024 / 1024; // MB
                
                performanceTests.push({
                    name: 'ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰',
                    value: `${memoryDiff.toFixed(2)} MB`,
                    status: memoryDiff < 50 ? 'pass' : 'fail'
                });
            }
            
            // API ì‘ë‹µ ì‹œê°„ í…ŒìŠ¤íŠ¸
            const apiStartTime = performance.now();
            try {
                await fetch('/api/test-db');
                const apiEndTime = performance.now();
                const apiResponseTime = apiEndTime - apiStartTime;
                
                performanceTests.push({
                    name: 'API ì‘ë‹µì‹œê°„',
                    value: `${apiResponseTime.toFixed(2)} ms`,
                    status: apiResponseTime < 1000 ? 'pass' : 'fail'
                });
            } catch (error) {
                performanceTests.push({
                    name: 'API ì‘ë‹µì‹œê°„',
                    value: 'Error',
                    status: 'fail'
                });
            }
            
            // ë Œë”ë§ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
            const renderStartTime = performance.now();
            const testDiv = document.createElement('div');
            for (let i = 0; i < 1000; i++) {
                const span = document.createElement('span');
                span.textContent = `í…ŒìŠ¤íŠ¸ ${i}`;
                testDiv.appendChild(span);
            }
            document.body.appendChild(testDiv);
            document.body.removeChild(testDiv);
            const renderEndTime = performance.now();
            const renderTime = renderEndTime - renderStartTime;
            
            performanceTests.push({
                name: 'ë Œë”ë§ ì„±ëŠ¥',
                value: `${renderTime.toFixed(2)} ms`,
                status: renderTime < 100 ? 'pass' : 'fail'
            });
            
            results.innerHTML = `
                <div class="metrics">
                    ${performanceTests.map(test => `
                        <div class="metric-card">
                            <strong>${test.name}</strong><br>
                            ${test.value}
                            <span class="status ${test.status}">${test.status.toUpperCase()}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ë°˜ì‘í˜• ë””ìì¸ í…ŒìŠ¤íŠ¸
        function testResponsiveDesign() {
            const results = document.getElementById('responsive-results');
            const viewports = [
                { name: 'ëª¨ë°”ì¼', width: 375, height: 667 },
                { name: 'íƒœë¸”ë¦¿', width: 768, height: 1024 },
                { name: 'ë°ìŠ¤í¬í†±', width: 1920, height: 1080 }
            ];
            
            results.innerHTML = `
                <div class="test-item">
                    <span class="status info">INFO</span>
                    í˜„ì¬ í™”ë©´ í¬ê¸°: ${window.innerWidth} x ${window.innerHeight}
                </div>
                ${viewports.map(vp => `
                    <div class="test-item">
                        <span class="status ${window.innerWidth >= vp.width ? 'pass' : 'pending'}">${window.innerWidth >= vp.width ? 'COMPATIBLE' : 'RESIZE NEEDED'}</span>
                        ${vp.name} (${vp.width} x ${vp.height})
                    </div>
                `).join('')}
                <div class="test-item">
                    <span class="status info">INFO</span>
                    ì°½ í¬ê¸°ë¥¼ ì¡°ì •í•˜ì—¬ ë°˜ì‘í˜• ë™ì‘ì„ í™•ì¸í•˜ì„¸ìš”.
                </div>
            `;
        }

        // ìƒ‰ìƒ ì½”ë”© í…ŒìŠ¤íŠ¸
        function testColorCoding() {
            const results = document.getElementById('color-results');
            
            results.innerHTML = `
                <div class="test-item">
                    <span class="status pass">PASS</span>
                    ìˆ˜ìµ: <span style="color: green; font-weight: bold;">+15,000ì› (+10.5%)</span>
                </div>
                <div class="test-item">
                    <span class="status pass">PASS</span>
                    ì†ì‹¤: <span style="color: red; font-weight: bold;">-8,500ì› (-3.2%)</span>
                </div>
                <div class="test-item">
                    <span class="status pass">PASS</span>
                    ì¤‘ë¦½: <span style="color: gray; font-weight: bold;">0ì› (0%)</span>
                </div>
                <div class="test-item">
                    <span class="status pass">PASS</span>
                    ìƒ‰ìƒ ì½”ë”©ì´ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
                </div>
            `;
        }

        // ìë™ìœ¼ë¡œ ëª‡ ê°€ì§€ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        window.addEventListener('load', () => {
            setTimeout(() => {
                testCalculations();
                testResponsiveDesign();
                testColorCoding();
            }, 2000);
        });
    </script>
</body>
</html>